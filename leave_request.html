<!doctype html><html lang="ar" dir="rtl"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <style>html,body{font-family:"Cairo",ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,"Noto Sans",sans-serif}</style>
<title>طلب إجازة</title></head>
<body class="min-h-screen bg-gray-50"><div id="toast-holder" class="fixed top-4 right-4 z-50"></div>
<nav class="bg-white shadow-sm"><div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between"><div class="flex items-center gap-3"><h1 class="text-sm font-bold" data-company-ar></h1></div><div class="flex items-center gap-4 text-sm"><a href="employee_home.html" class="text-blue-700">الرجوع</a></div></div></nav>
<main class="max-w-4xl mx-auto p-4"><h2 class="text-xl font-bold mb-4">طلب إجازة</h2>
<form id="leaveForm" class="bg-white rounded-2xl shadow p-4 grid grid-cols-1 md:grid-cols-2 gap-4">
  <div><label class="text-sm">نوع الإجازة</label><select id="leave_type" class="w-full border rounded-lg px-3 py-2" required>
    <option value="annual">Annual</option><option value="sick">Sick</option><option value="compassionate">Compassionate</option><option value="duty">Duty</option><option value="emergency">Emergency</option><option value="hajj">Hajj</option><option value="other">Other</option>
  </select></div>
  <div><label class="text-sm">First Date</label><input id="first_date" type="date" class="w-full border rounded-lg px-3 py-2" required></div>
  <div><label class="text-sm">Last Date</label><input id="last_date" type="date" class="w-full border rounded-lg px-3 py-2" required></div>
  <div><label class="text-sm">Total Days</label><input id="total_days" type="number" min="1" class="w-full border rounded-lg px-3 py-2"></div>
  <div class="md:col-span-2 font-bold mt-2">Travel / Documents</div>
  <div><label class="text-sm">Company Ticket</label><select id="company_ticket" class="w-full border rounded-lg px-3 py-2"><option value="">—</option><option value="true">Yes</option><option value="false">No</option></select></div>
  <div><label class="text-sm">Passport Release</label><select id="passport_release" class="w-full border rounded-lg px-3 py-2"><option value="">—</option><option value="true">Yes</option><option value="false">No</option></select></div>
  <div><label class="text-sm">Ticket Start</label><input id="ticket_start" type="date" class="w-full border rounded-lg px-3 py-2"></div>
  <div><label class="text-sm">Ticket Return</label><input id="ticket_return" type="date" class="w-full border rounded-lg px-3 py-2"></div>
  <div><label class="text-sm">Airport Name</label><input id="airport_name" class="w-full border rounded-lg px-3 py-2"></div>
  <div class="md:col-span-2 font-bold mt-2">Contacts & PSFRD</div>
  <div><label class="text-sm">Contact UAE</label><input id="contact_uae" class="w-full border rounded-lg px-3 py-2"></div>
  <div><label class="text-sm">Contact Home</label><input id="contact_home" class="w-full border rounded-lg px-3 py-2"></div>
  <div><label class="text-sm">PSFRD Issue</label><input id="psfrd_issue" type="date" class="w-full border rounded-lg px-3 py-2"></div>
  <div><label class="text-sm">PSFRD Expiry</label><input id="psfrd_expiry" type="date" class="w-full border rounded-lg px-3 py-2"></div>
  <div class="md:col-span-2"><label class="text-sm">Other (Specify)</label><input id="other_specify" class="w-full border rounded-lg px-3 py-2"></div>
  <div class="md:col-span-2"><button class="w-full bg-green-600 text-white rounded-lg py-2">إرسال الطلب</button></div>
</form></main>
<script type="module">
  import { requireAuth } from './js/auth.js'; import { toast, setCompanyBranding } from './js/ui.js'; import { submitLeaveRequest } from './js/api.js';
  setCompanyBranding(); const ctx = await requireAuth(['employee','supervisor']);
  const val = id => { const v=document.getElementById(id).value.trim(); return v===''?null:v; };
  document.getElementById('leaveForm').addEventListener('submit', async (e)=>{ e.preventDefault();
    const payload = { leave_type: val('leave_type'), first_date: val('first_date'), last_date: val('last_date'),
      total_days: document.getElementById('total_days').value? parseInt(document.getElementById('total_days').value): null,
      company_ticket: val('company_ticket')? (val('company_ticket')==='true') : null, passport_release: val('passport_release')? (val('passport_release')==='true') : null,
      ticket_start: val('ticket_start'), ticket_return: val('ticket_return'), airport_name: val('airport_name'),
      contact_uae: val('contact_uae'), contact_home: val('contact_home'), psfrd_issue: val('psfrd_issue'), psfrd_expiry: val('psfrd_expiry'), other_specify: val('other_specify') };
    try{ await submitLeaveRequest(payload); toast('تم إرسال الطلب'); e.target.reset(); } catch(err){ toast('فشل الإرسال: '+err.message,'error'); }
  });
</script></body></html>